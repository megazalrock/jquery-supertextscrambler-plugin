/*! jQuery Super Text Scrambler 2014-05-01
 *  Vertion : 1.0.0
 *  Dependencies : jQuery *
 *  Author : MegazalRock (Otto Kamiya)
 *  Copyright (c) 2014 MegazalRock (Otto Kamiya);
 *  License : */
(function(e,t){function r(e,t){for(var r=0;t>r;r+=1)e.currentText=e.text.slice(0,e.currentTextLength+1),e.currentTextLength=e.currentText.length;return e.currentText}function a(e,r,a){var n=[];if("typewriter"===a)n=r%2?["_"]:[" ","|"," "],2>r&&(n=n.splice(0,n.length-(2-r)));else{var o,i,s,h=0,c=t.isArray(e.charTable[a]);for(c||(o=e.charTable[a].startCharCode,i=e.charTable[a].endCharCode);r>h;h++)c&&(s=Math.floor(Math.random()*e.charTable[a].length),o=e.charTable[a][s].startCharCode,i=e.charTable[a][s].endCharCode),-1!==t.inArray(h,e.spaceIndexList)&&e.options.saveSpace?n.push(" "):n.push(String.fromCharCode(o+Math.floor(Math.random()*(i-o))))}return n.join("")}function n(e){e.options.autoWordBreak&&e.$target.css(e.defaultCss),e.deferred.resolve(),e.$target.trigger("scramblerEnd")}function o(e,t){for(var r=[],a=e.indexOf(t);-1!==a;a=e.indexOf(t,a+1))r.push(a);return r}e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(function(){t(Date.now())},1e3/60)},e.cancelAnimationFrame=e.cancelAnimationFrame||e.webkitCancelAnimationFrame||e.mozCancelAnimationFrame||e.oCancelAnimationFrame||e.msCancelAnimationFrame||function(e){return clearTimeout(e)};var i={mode:"auto",wait:1e3,fps:30,textFps:30,autoWordBreak:!0,saveSpace:!0,returnPrimise:!1,addQueue:!0},s=function(e,r,a){var n;a=a||{},this.options=t.extend(!0,{},t.extend(!0,i,a)),this.text=r,this.length=r.length,this.currentTextLength=0,this.currentText="",this.spaceIndexList=o(this.text," "),this.charTable={kanji:{startCharCode:20124,endCharCode:29081,length:8957},hiragana:{startCharCode:12353,endCharCode:12435,length:82},katakana:{startCharCode:12449,endCharCode:12534,length:85},ja:[],keisen:{startCharCode:9472,endCharCode:9538,length:66},en:{startCharCode:65,endCharCode:122,length:57}},this.charTable.ja=[this.charTable.kanji,this.charTable.hiragana,this.charTable.katakana],this.charTableJaLength=0;for(n in this.charTable.ja)this.charTableJaLength+=this.charTable.ja[n].length;this.$target=e};s.prototype.init=function(){var e=this,r=e.$target;e.currentTextLength=0,e.currentText="",e.deferred=t.Deferred(),"auto"===e.options.mode&&(e.options.mode=/[ぁ-ん]/.test(e.text)||/[ァ-ン]/.test(e.text)?"ja":"en"),e.options.autoWordBreak&&(e.defaultCss={wordWrap:r.css("word-wrap"),wordBreak:r.css("word-break")},r.css({wordWrap:"break-word",wordBreak:"break-all"})),r.trigger("scramblerStart")},s.prototype.start=function(){var t,o,i,s=this,h=s.$target,c=s.length,u=s.options.mode,d=Date.now(),l=1e3/s.options.fps,m=d,f=1e3/s.options.textFps,p=Math.floor(s.options.textFps/30)+(s.options.textFps%30?1:0);return setTimeout(function(){(function x(){o=Date.now(),s.rafId=e.requestAnimationFrame(x),t=o-d,i=o-m,c>s.currentTextLength?t>=l&&(i>=f?h.text(r(s,p)+a(s,c-s.currentTextLength,u)):h.text(s.currentText+a(s,c-s.currentTextLength,u)),d=o-t%l,m=o-i%f):(e.cancelAnimationFrame(s.rafId),n(s))})()},s.options.wait),s.deferred.promise()},t.extend({SuperTextScrambler:function(e,t){return new s(e,t)}}),t.fn.extend({superTextScrambler:function(e){e=t.extend(!0,i,e);var r,a=t(this),n=a.length,o=0;return e.returnPrimise&&(r=t.Deferred()),function h(){var t=a.eq(o),r=t.text();0!==o&&(e.wait=0);var i=t.data("SuperTextScrambler")||new s(t,r,e);i.init(),i.start().done(function(){n>o+1&&(o+=1,h())})}(),e.returnPrimise?r.promise():this}})})(this,jQuery);