/*! jQuery Super Text Scrambler 2014-03-14
 *  Vertion : 0.1.0
 *  Dependencies : jQuery *
 *  Author : MegazalRock (Otto Kamiya)
 *  Copyright (c) 2014 MegazalRock (Otto Kamiya);
 *  License : */
(function(t,e){t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e){return t.setTimeout(function(){e(Date.now())},1e3/60)},t.cancelAnimationFrame=t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.oCancelAnimationFrame||t.msCancelAnimationFrame||function(t){return clearTimeout(t)};var r=function(t,r){r=r||{},this.options=e.extend(!0,{mode:"en",wait:1e3,fps:30,textFps:30,autoWordBreak:!0,saveSpace:!0},r),this.text=t,this.length=t.length,this.currentTextLength=0,this.currentText="",this.spaceIndexList=this.allIndexOf(this.text," "),this.charTable={kanji:{startCharCode:20124,endCharCode:29081},hiragana:{startCharCode:12353,endCharCode:12435},katakana:{startCharCode:12449,endCharCode:12534},keisen:{startCharCode:9472,endCharCode:9538},en:{startCharCode:65,endCharCode:122}}};r.prototype.init=function(t){var e=this;e.$target=t,e.currentTextLength=0,e.currentText="",e.options.autoWordBreak&&(e.defaultCss={wordWrap:t.css("word-wrap"),wordBreak:t.css("word-break")},t.css({wordWrap:"break-word",wordBreak:"break-all"})),t.trigger("scramblerStart")},r.prototype.start=function(){var e,r,n,a=this,o=a.$target,i=a.length,s=a.options.mode,c=Date.now(),u=1e3/a.options.fps,d=c,h=1e3/a.options.textFps,m=Math.floor(a.options.textFps/30)+(a.options.textFps%30?1:0);setTimeout(function(){(function p(){r=Date.now(),a.rafId=t.requestAnimationFrame(p),e=r-c,n=r-d,i>a.currentTextLength?e>=u&&(n>=h?o.text(a.stepText(m)+a.getRndText(i-a.currentTextLength,s)):o.text(a.currentText+a.getRndText(i-a.currentTextLength,s)),c=r-e%u,d=r-n%h):(t.cancelAnimationFrame(a.rafId),a.end())})()},a.options.wait)},r.prototype.stepText=function(t){for(var e=this,r=0;t>r;r+=1)e.currentText=e.text.slice(0,e.currentTextLength+1),e.currentTextLength=e.currentText.length;return e.currentText},r.prototype.getRndText=function(t,r){var n,a,o=this,i=[],s=0;for(r=r||"en",-1!==r.indexOf(",")||(n=o.charTable[r].startCharCode,a=o.charTable[r].endCharCode);t>s;s++)-1!==e.inArray(s,o.spaceIndexList)&&o.options.saveSpace?i.push(" "):i.push(String.fromCharCode(n+Math.floor(Math.random()*(a-n))));return i.join("")},r.prototype.end=function(){var t=this;t.options.autoWordBreak&&t.$target.css(t.defaultCss),t.$target.trigger("scramblerEnd")},r.prototype.allIndexOf=function(t,e){for(var r=[],n=t.indexOf(e);-1!==n;n=t.indexOf(e,n+1))r.push(n);return r},e.extend({SuperTextScrambler:function(t,e){return new r(t,e)}}),e.fn.extend({superTextScrambler:function(t){return e(this).each(function(){var n=e(this),a=n.text();if((a+"").length){var o=n.data("SuperTextScrambler")||new r(a,t);o.init(n),o.start(),n.data("SuperTextScrambler",o)}}),this}})})(this,jQuery);